<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pip-Boy 3000 - Professional Replica</title>
    <style>
        /* AUTHENTIC PIP-BOY 3000 STYLING
           Designed for high-fidelity CRT simulation
        */
        :root {
            --pip-green: #1aff80;
            --pip-green-dim: rgba(26, 255, 128, 0.12);
            --pip-green-med: rgba(26, 255, 128, 0.4);
            --pip-glow: rgba(26, 255, 128, 0.6);
            --pip-bg: #0b140e;
            --crt-curve: perspective(1200px) rotateX(2.5deg) rotateY(-1.5deg);
        }

        * { 
            box-sizing: border-box;
            cursor: default;
        }

        body {
            background-color: #020202;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            font-family: 'Courier New', Courier, monospace;
            overflow: hidden;
            color: var(--pip-green);
            text-transform: uppercase;
        }

        /* --- HARDWARE CHASSIS --- */
        .pipboy-module {
            width: 900px;
            height: 680px;
            position: relative;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            /* USING YOUR LOCAL ASSETS */
            background-image: url('assets/screen/monitorborder.png'); 
            transition: background-image 0.2s;
        }

        .pipboy-module.off {
            background-image: url('assets/screen/monitorborder-off.png');
            filter: brightness(0.2);
        }

        /* --- CRT SCREEN CONTAINER --- */
        .screen-area {
            position: absolute;
            top: 85px;
            left: 110px;
            width: 670px;
            height: 440px;
            /* USING YOUR LOCAL BG */
            background-image: url('assets/screen/bg.png');
            background-size: cover;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            color: var(--pip-green);
            text-shadow: 0 0 5px var(--pip-glow);
            z-index: 1;
            border-radius: 25px;
            transform: var(--crt-curve);
            box-shadow: inset 0 0 60px rgba(0,0,0,1), 0 0 20px rgba(26, 255, 128, 0.1);
            border: 2px solid #152515;
        }

        .off .screen-area {
            display: none;
        }

        /* Scanline Overlay */
        .scanlines {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(
                rgba(18, 16, 16, 0) 50%, 
                rgba(0, 0, 0, 0.25) 50%
            );
            background-size: 100% 3px;
            z-index: 50;
            pointer-events: none;
            opacity: 0.8;
        }

        /* Screen Flicker Base */
        .screen-area::before {
            content: " ";
            display: block;
            position: absolute;
            top: 0; left: 0; bottom: 0; right: 0;
            background: rgba(26, 255, 128, 0.02);
            opacity: 0;
            z-index: 49;
            pointer-events: none;
            animation: static-noise 0.2s infinite;
        }

        @keyframes static-noise {
            0% { transform: translate(0,0) }
            10% { transform: translate(-1%,-1%) }
            20% { transform: translate(1%,1%) }
            30% { transform: translate(-1%,1%) }
            40% { transform: translate(1%,-1%) }
            50% { transform: translate(-1%,0) }
            60% { transform: translate(1%,0) }
            70% { transform: translate(0,-1%) }
            80% { transform: translate(0,1%) }
            90% { transform: translate(1%,1%) }
            100% { transform: translate(0,0) }
        }

        /* --- HEADER & NAVIGATION --- */
        header {
            padding: 20px 50px 0 50px;
            z-index: 10;
        }

        .main-nav {
            display: flex;
            justify-content: space-between;
            border-bottom: 4px solid var(--pip-green);
            padding-bottom: 2px;
        }

        .nav-item {
            cursor: pointer;
            font-size: 1.6rem;
            font-weight: 900;
            letter-spacing: 4px;
            opacity: 0.4;
            transition: 0.1s;
            user-select: none;
        }

        .nav-item:hover {
            opacity: 0.7;
        }

        .nav-item.active {
            opacity: 1;
            text-shadow: 0 0 15px var(--pip-green);
        }

        .sub-nav {
            display: flex;
            justify-content: center;
            gap: 25px;
            padding: 10px 0;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .sub-tab {
            cursor: pointer;
            opacity: 0.6;
            padding: 2px 12px;
            transition: 0.15s;
        }

        .sub-tab:hover {
            opacity: 1;
            background: var(--pip-green-dim);
        }

        .sub-tab.active {
            opacity: 1;
            background: var(--pip-green);
            color: #0b140e;
            text-shadow: none;
        }

        /* --- CONTENT AREA --- */
        #viewport {
            flex-grow: 1;
            padding: 10px 50px;
            overflow-y: hidden;
            position: relative;
            z-index: 5;
        }

        /* --- FOOTER --- */
        footer {
            height: 50px;
            border-top: 3px solid var(--pip-green);
            margin: 0 50px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 900;
            font-size: 0.9rem;
            background: rgba(0,0,0,0.4);
        }

        .footer-stat-group {
            display: flex;
            gap: 20px;
        }

        /* --- REUSABLE COMPONENTS --- */
        .list-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            height: 100%;
        }

        .scroll-list {
            height: 250px;
            overflow-y: auto;
            border-right: 1px solid var(--pip-green-dim);
            padding-right: 10px;
        }

        .list-entry {
            padding: 5px 10px;
            margin-bottom: 2px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            transition: 0.1s;
        }

        .list-entry:hover {
            background: var(--pip-green-dim);
        }

        .list-entry.selected {
            background: var(--pip-green-med);
            color: #fff;
        }

        .info-panel {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .detail-box {
            border: 2px solid var(--pip-green);
            padding: 15px;
            background: rgba(0,0,0,0.5);
            font-size: 0.85rem;
            line-height: 1.4;
            flex-grow: 1;
            overflow-y: auto;
        }

        /* Progress Bars */
        .progress-bar-wrap {
            margin-bottom: 12px;
        }

        .pb-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            margin-bottom: 4px;
        }

        .pb-outer {
            height: 12px;
            border: 1px solid var(--pip-green);
            padding: 1px;
        }

        .pb-inner {
            height: 100%;
            background: var(--pip-green);
            box-shadow: 0 0 10px var(--pip-green);
        }

        /* Condition Layout */
        .condition-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            height: 100%;
            align-items: center;
        }

        .vault-boy-visual {
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            height: 220px;
        }

        .limb-indicator {
            position: absolute;
            font-size: 0.7rem;
            font-weight: bold;
            border: 1px solid var(--pip-green);
            padding: 1px 4px;
            background: black;
        }

        .limb-head { top: 5%; left: 50%; transform: translateX(-50%); }
        .limb-la { top: 40%; left: 15%; }
        .limb-ra { top: 40%; right: 15%; }
        .limb-ll { bottom: 5%; left: 25%; }
        .limb-rl { bottom: 5%; right: 25%; }

        /* Animations */
        @keyframes micro-flicker {
            0% { opacity: 0.98; filter: brightness(1); }
            50% { opacity: 1; filter: brightness(1.05); }
            100% { opacity: 0.99; filter: brightness(0.95); }
        }

        .flicker-heavy {
            animation: heavy-flicker-anim 0.1s steps(2) infinite;
        }

        @keyframes heavy-flicker-anim {
            0% { opacity: 1; filter: contrast(1.2) brightness(1.2); }
            50% { opacity: 0.7; filter: contrast(0.8) brightness(0.6); }
            100% { opacity: 1; }
        }

        .tab-transition {
            animation: slide-in 0.2s ease-out;
        }

        @keyframes slide-in {
            from { transform: translateX(20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--pip-green); }

        .btn-power {
            position: absolute;
            bottom: 60px;
            right: 140px;
            width: 70px;
            height: 70px;
            cursor: pointer;
            z-index: 100;
        }

        .visualizer {
            display: flex;
            align-items: flex-end;
            gap: 3px;
            height: 40px;
            margin-top: 10px;
        }
        .v-bar {
            width: 4px;
            background: var(--pip-green);
            animation: v-jump 0.5s infinite alternate;
        }
        @keyframes v-jump {
            from { height: 5px; }
            to { height: 100%; }
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.2; }
        }
    </style>
</head>
<body>

<div class="pipboy-module" id="pip-chassis">
    <div class="screen-area" id="crt-screen">
        <div class="scanlines"></div>
        
        <header>
            <nav class="main-nav">
                <div class="nav-item active" onclick="ui.changeMainTab('STAT', this)">STAT</div>
                <div class="nav-item" onclick="ui.changeMainTab('INV', this)">INV</div>
                <div class="nav-item" onclick="ui.changeMainTab('DATA', this)">DATA</div>
            </nav>
            <div class="sub-nav" id="sub-nav"></div>
        </header>

        <main id="viewport"></main>

        <footer>
            <div class="footer-stat-group">
                <span id="f-hp">HP 285/300</span>
                <span id="f-lvl">LEVEL 42</span>
            </div>
            <div class="footer-stat-group">
                <span id="f-ap">AP 110/110</span>
                <span style="color: #ffaa00; animation: blink 2s infinite;">CORE STABLE</span>
            </div>
        </footer>
    </div>

    <div class="btn-power" onclick="ui.togglePower()"></div>
</div>

<script>
/**
 * PIP-BOY 3000 CORE LOGIC - HIGH DENSITY EDITION
 */

const ENGINE_DATA = {
    STAT: {
        tabs: ['CND', 'SPECIAL', 'PERKS', 'GENERAL'],
        content: {
            CND: {
                type: 'status',
                limbs: { head: 100, la: 92, ra: 100, ll: 88, rl: 100 },
                stats: [
                    { label: 'SMALL GUNS', val: 95 },
                    { label: 'BIG GUNS', val: 40 },
                    { label: 'ENERGY WEAP.', val: 85 },
                    { label: 'EXPLOSIVES', val: 55 },
                    { label: 'MELEE WEAP.', val: 35 },
                    { label: 'UNARMED', val: 25 },
                    { label: 'SNEAK', val: 100 },
                    { label: 'LOCKPICK', val: 80 }
                ]
            },
            SPECIAL: [
                { id: 'S', name: 'STRENGTH', val: 7, desc: 'A MEASURE OF YOUR RAW PHYSICAL POWER. IT AFFECTS CARRY WEIGHT AND MELEE DAMAGE.' },
                { id: 'P', name: 'PERCEPTION', val: 8, desc: 'AFFECTS WEAPON ACCURACY IN V.A.T.S. AND DETECTION OF ENEMIES ON COMPASS.' },
                { id: 'E', name: 'ENDURANCE', val: 6, desc: 'DETERMINES TOTAL HIT POINTS, RESISTANCE TO ENVIRONMENTAL HAZARDS, AND STAMINA.' },
                { id: 'C', name: 'CHARISMA', val: 9, desc: 'INFLUENCES SUCCESS IN DIALOGUE CHALLENGES AND PRICES AT TRADERS.' },
                { id: 'I', name: 'INTELLIGENCE', val: 10, desc: 'DETERMINES THE NUMBER OF SKILL POINTS EARNED PER LEVEL UP.' },
                { id: 'A', name: 'AGILITY', val: 7, desc: 'DETERMINES THE TOTAL NUMBER OF ACTION POINTS AVAILABLE FOR V.A.T.S.' },
                { id: 'L', name: 'LUCK', val: 6, desc: 'RAISES THE CHANCE OF CRITICAL HITS AND IMPROVES CHANCES IN ALL GAMES OF CHANCE.' }
            ],
            PERKS: [
                { name: 'ACTION BOY', rank: 2, desc: 'YOUR ACTION POINTS REGENERATE 50% FASTER THAN NORMAL.' },
                { name: 'ANIMAL FRIEND', rank: 1, desc: 'ANIMALS WILL NOT ATTACK YOU UNLESS PROVOKED.' },
                { name: 'AWARENESS', rank: 1, desc: 'VIEW SPECIFIC DAMAGE RESISTANCES OF TARGETS IN V.A.T.S.' },
                { name: 'BETTER CRITICALS', rank: 1, desc: 'CRITICAL HITS CAUSE 50% MORE DAMAGE.' },
                { name: 'BLOODY MESS', rank: 1, desc: 'YOU DEAL +5% OVERALL DAMAGE. TARGETS MAY EXPLODE SPECTACULARLY.' },
                { name: 'COMMANDO', rank: 2, desc: 'ACCURACY WITH RIFLES IS INCREASED BY 30%.' },
                { name: 'CONCENTRATED FIRE', rank: 1, desc: 'V.A.T.S. ACCURACY INCREASES WITH EVERY SUBSEQUENT HIT ON THE SAME BODY PART.' },
                { name: 'GRIM REAPER SPRINT', rank: 1, desc: 'A KILL IN V.A.T.S. IMMEDIATELY RESTORES ACTION POINTS.' },
                { name: 'HACKER', rank: 3, desc: 'YOU CAN BYPASS TERMINAL SECURITY UP TO THE HIGHEST LEVEL.' },
                { name: 'INFILTRATOR', rank: 1, desc: 'IF A LOCK IS BROKEN, YOU CAN ATTEMPT TO PICK IT ONE MORE TIME.' },
                { name: 'LIFE GIVER', rank: 3, desc: 'YOUR MAXIMUM HIT POINTS ARE INCREASED BY 60.' },
                { name: 'MYSTERIOUS STRANGER', rank: 1, desc: 'A HELPFUL STRANGER SOMETIMES APPEARS IN V.A.T.S. TO FINISH OFF FOES.' },
                { name: 'NIGHT PERSON', rank: 1, desc: 'GAIN +2 INTELLIGENCE AND PERCEPTION BETWEEN 6:00 PM AND 6:00 AM.' },
                { name: 'ROBOTICS EXPERT', rank: 2, desc: 'DEAL MORE DAMAGE TO ROBOTS AND CAN SHUT THEM DOWN IF UNDETECTED.' },
                { name: 'SCIENCE!', rank: 4, desc: 'ACCESS TO ADVANCED TECHNOLOGY MODIFICATIONS.' },
                { name: 'SCROUNGER', rank: 2, desc: 'YOU FIND SIGNIFICANTLY MORE AMMUNITION IN CONTAINERS.' },
                { name: 'SNEAK', rank: 5, desc: 'YOU ARE 50% HARDER TO DETECT AND NO LONGER TRIGGER FLOOR TRAPS.' },
                { name: 'TOUGHNESS', rank: 3, desc: 'YOUR OVERALL DAMAGE RESISTANCE IS INCREASED BY 15%.' }
            ],
            GENERAL: [
                { label: 'KILLS', val: '2,814' },
                { label: 'LOCATIONS DISCOVERED', val: '142' },
                { label: 'LOCKS PICKED', val: '315' },
                { label: 'HACKING SUCCESSES', val: '124' },
                { label: 'QUESTS COMPLETED', val: '58' },
                { label: 'SPEECH SUCCESSES', val: '45' },
                { label: 'STOLEN ITEMS', val: '12' },
                { label: 'KARMA', val: 'VERY GOOD (SENTINEL)' },
                { label: 'CAPS FOUND', val: '15,402' },
                { label: 'STIMPAKS USED', val: '412' }
            ]
        }
    },
    INV: {
        tabs: ['WEAPONS', 'APPAREL', 'AID', 'MISC', 'AMMO'],
        content: {
            WEAPONS: [
                { name: '10MM PISTOL', dam: 22, wt: 3, val: 350, desc: 'RELIABLE HANDGUN WITH CUSTOM COMPENSATOR.', ammo: '10MM' },
                { name: 'ASSAULT RIFLE', dam: 48, wt: 14, val: 950, desc: 'FULLY AUTOMATIC 5.56MM RIFLE.', ammo: '5.56MM' },
                { name: 'COMBAT SHOTGUN', dam: 65, wt: 11, val: 720, desc: 'DEVASTATING AT CLOSE RANGE.', ammo: 'SHELLS' },
                { name: 'GAUSS RIFLE', dam: 110, wt: 16, val: 2400, desc: 'HIGH-TECH ELECTROMAGNETIC PROJECTILE WEAPON.', ammo: '2MM EC' },
                { name: 'HUNTING RIFLE', dam: 38, wt: 10, val: 400, desc: 'BOLT-ACTION PRECISION RIFLE.', ammo: '.308' },
                { name: 'LASER PISTOL', dam: 28, wt: 4, val: 650, desc: 'INSTITUTE MODEL WITH UPGRADED CAPACITOR.', ammo: 'FC' },
                { name: 'LASER RIFLE', dam: 52, wt: 9, val: 1400, desc: 'AER9 MODEL WITH SNIPER BARREL.', ammo: 'MF CELL' },
                { name: 'MINIGUN', dam: 12, wt: 28, val: 1800, desc: 'RAPID FIRE HEAVY WEAPON.', ammo: '5MM' },
                { name: 'PLASMA RIFLE', dam: 74, wt: 12, val: 2100, desc: 'PROJECTS BOLTS OF SUPERHEATED PLASMA.', ammo: 'CART.' },
                { name: 'SUPER SLEDGE', dam: 85, wt: 20, val: 1500, desc: 'POWERED MELEE WEAPON.', ammo: 'N/A' }
            ],
            APPAREL: [
                { name: 'VAULT 111 JUMPSUIT', dr: 8, wt: 2, desc: 'INSULATED LINING UPGRADE.' },
                { name: 'COMBAT ARMOR CHEST', dr: 22, wt: 15, desc: 'REINFORCED POLYMER PLATES.' },
                { name: 'COMBAT ARMOR LEFT ARM', dr: 12, wt: 6, desc: 'STANDARD MILITARY ISSUE.' },
                { name: 'COMBAT ARMOR RIGHT ARM', dr: 12, wt: 6, desc: 'STANDARD MILITARY ISSUE.' },
                { name: 'COMBAT ARMOR LEFT LEG', dr: 12, wt: 6, desc: 'STANDARD MILITARY ISSUE.' },
                { name: 'COMBAT ARMOR RIGHT LEG', dr: 12, wt: 6, desc: 'STANDARD MILITARY ISSUE.' },
                { name: 'GAS MASK', dr: 2, wt: 3, desc: 'FILTERED BREATHING APPARATUS.' },
                { name: 'MILITARY FATIGUES', dr: 5, wt: 4, desc: 'TOUGH CLOTH UNDER-ARMOR.' },
                { name: 'WORN FEDORA', dr: 0, wt: 1, desc: '+1 LUCK.' }
            ],
            AID: [
                { name: 'STIMPAK (32)', val: 'HEAL', desc: 'RESTORES 30% HP.' },
                { name: 'RADAWAY (12)', val: 'RADS', desc: 'REMOVES 300 RADS.' },
                { name: 'RAD-X (6)', val: 'RESIST', desc: 'INCREASES RAD RESISTANCE.' },
                { name: 'PURIFIED WATER (14)', val: 'HYDRATE', desc: 'CLEAN WATER.' },
                { name: 'INSTAMASH', val: 'FOOD', desc: 'PRE-WAR PROCESSED POTATOES.' },
                { name: 'SALISBURY STEAK', val: 'FOOD', desc: 'PRE-WAR CANNED MEAT.' },
                { name: 'NUKA-COLA (4)', val: 'ENERGY', desc: 'CLASSIC REFRESHMENT.' },
                { name: 'NUKA-COLA QUANTUM', val: 'AP', desc: 'GLOWING BLUE SODA.' },
                { name: 'BLOOD PACK', val: 'HEAL', desc: 'RESTORATIVE FLUID.' },
                { name: 'MUTFruit (8)', val: 'FOOD', desc: 'MUTATED FRUIT.' }
            ],
            MISC: [
                { name: 'BOBBY PIN (58)', val: 'TOOLS' },
                { name: 'BOTTLECAP (15402)', val: 'CURRENCY' },
                { name: 'OVERSEER LOG #1', val: 'TAPE' },
                { name: 'OVERSEER LOG #2', val: 'TAPE' },
                { name: 'STARCHY SCRAP', val: 'JUNK' },
                { name: 'WONDERGLUE', val: 'JUNK' },
                { name: 'DUCT TAPE', val: 'JUNK' },
                { name: 'CAMERA', val: 'JUNK' },
                { name: 'MILITARY GRADE CIRCUIT', val: 'JUNK' }
            ],
            AMMO: [
                { name: '10MM ROUND', val: '1,420' },
                { name: '5.56MM ROUND', val: '860' },
                { name: '.45 CALIBER', val: '450' },
                { name: '.308 CALIBER', val: '120' },
                { name: '5MM ROUND', val: '2,400' },
                { name: 'SHOTGUN SHELL', val: '315' },
                { name: 'MF CELL', val: '480' },
                { name: 'PLASMA CART.', val: '195' },
                { name: '2MM EC', val: '45' },
                { name: 'FUSION CORE', val: '12' }
            ]
        }
    },
    DATA: {
        tabs: ['QUESTS', 'MAP', 'RADIO'],
        content: {
            QUESTS: [
                { name: 'THE BIG SEARCH', status: 'ACTIVE', desc: 'FIND THE MISSING SETTLERS NEAR THE COAST.' },
                { name: 'TECH RECOVERY', status: 'ACTIVE', desc: 'RETRIEVE THE MISSING SENSOR MODULE FROM THE RUINS.' },
                { name: 'OUT OF TIME', status: 'COMPLETED', desc: 'SEARCH FOR CLUES IN YOUR OLD HOME.' },
                { name: 'A NEW DAWN', status: 'COMPLETED', desc: 'RE-ESTABLISH COMMUNICATIONS AT THE ARRAY.' },
                { name: 'ROAD TO FREEDOM', status: 'ACTIVE', desc: 'FOLLOW THE BRICK PATH.' },
                { name: 'THE FIRST STEP', status: 'COMPLETED', desc: 'HELP THE LOCAL SETTLEMENT.' },
                { name: 'DIAMOND CITY BLUES', status: 'COMPLETED', desc: 'SOLVE THE DISPUTE AT THE BAR.' }
            ],
            MAP: {
                loc: 'WASTELAND SECTOR 7',
                pos: 'OUTPOST EPSILON'
            },
            RADIO: [
                { name: 'CLASSIC TUNES', status: 'ON', song: 'BLUE MOON' },
                { name: 'NEWS BROADCAST', status: 'OFF', song: 'REPORTS' },
                { name: 'DISTRESS SIGNAL', status: 'OFF', song: 'STATIC' },
                { name: 'VAULT BEACON', status: 'OFF', song: 'AUTOMATED' }
            ]
        }
    }
};

const ui = {
    currentTab: 'STAT',
    currentSub: 'CND',
    isPowerOn: true,

    init() {
        this.renderSubNav();
        this.renderContent();
        this.startGlitches();
        window.addEventListener('resize', this.autoScale);
        this.autoScale();
    },

    autoScale() {
        const chassis = document.getElementById('pip-chassis');
        const scale = Math.min(window.innerWidth / 920, window.innerHeight / 700);
        chassis.style.transform = scale < 1 ? `scale(${scale})` : `scale(1)`;
    },

    togglePower() {
        this.isPowerOn = !this.isPowerOn;
        document.getElementById('pip-chassis').classList.toggle('off', !this.isPowerOn);
        if (this.isPowerOn) this.triggerFlicker(300);
    },

    changeMainTab(tab, el) {
        if (!this.isPowerOn) return;
        this.currentTab = tab;
        this.currentSub = ENGINE_DATA[tab].tabs[0];
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        el.classList.add('active');
        this.triggerFlicker(100);
        this.renderSubNav();
        this.renderContent();
    },

    changeSubTab(sub, el) {
        if (!this.isPowerOn) return;
        this.currentSub = sub;
        document.querySelectorAll('.sub-tab').forEach(i => i.classList.remove('active'));
        el.classList.add('active');
        this.renderContent();
    },

    renderSubNav() {
        const container = document.getElementById('sub-nav');
        container.innerHTML = '';
        ENGINE_DATA[this.currentTab].tabs.forEach(tab => {
            const div = document.createElement('div');
            div.className = `sub-tab ${tab === this.currentSub ? 'active' : ''}`;
            div.innerText = tab;
            div.onclick = () => this.changeSubTab(tab, div);
            container.appendChild(div);
        });
    },

    renderContent() {
        const viewport = document.getElementById('viewport');
        viewport.innerHTML = '';
        const data = ENGINE_DATA[this.currentTab].content[this.currentSub];
        const wrapper = document.createElement('div');
        wrapper.className = 'tab-transition';

        if (this.currentSub === 'CND') {
            wrapper.innerHTML = this.getConditionHTML(data);
        } else if (Array.isArray(data)) {
            wrapper.innerHTML = this.getListHTML(data);
        } else if (this.currentSub === 'MAP') {
            wrapper.innerHTML = this.getMapHTML(data);
        }

        viewport.appendChild(wrapper);
        this.initListEvents();
    },

    getConditionHTML(data) {
        return `
            <div class="condition-layout">
                <div class="vault-boy-visual">
                    <div class="limb-indicator limb-head">CND ${data.limbs.head}%</div>
                    <div class="limb-indicator limb-la">CND ${data.limbs.la}%</div>
                    <div class="limb-indicator limb-ra">CND ${data.limbs.ra}%</div>
                    <div class="limb-indicator limb-ll">CND ${data.limbs.ll}%</div>
                    <div class="limb-indicator limb-rl">CND ${data.limbs.rl}%</div>
                    <svg viewBox="0 0 100 120" width="160">
                         <path d="M50 10 C60 10 65 20 65 30 C65 40 60 45 50 45 C40 45 35 40 35 30 C35 20 40 10 50 10" fill="none" stroke="var(--pip-green)" stroke-width="2"/>
                         <path d="M50 45 L50 85 M50 50 L25 75 M50 50 L75 75 M50 85 L35 115 M50 85 L65 115" fill="none" stroke="var(--pip-green)" stroke-width="2"/>
                    </svg>
                </div>
                <div class="stat-bars" style="overflow-y:auto; height:100%; padding-right:10px;">
                    ${data.stats.map(s => `
                        <div class="progress-bar-wrap">
                            <div class="pb-label"><span>${s.label}</span><span>${s.val}</span></div>
                            <div class="pb-outer"><div class="pb-inner" style="width: ${s.val}%"></div></div>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
    },

    getListHTML(items) {
        const isRadio = this.currentSub === 'RADIO';
        return `
            <div class="list-container">
                <div class="scroll-list">
                    ${items.map((item, idx) => `
                        <div class="list-entry ${idx === 0 ? 'selected' : ''}" data-idx="${idx}">
                            <span>${item.name || item.label}</span>
                            <span>${item.val || item.status || (item.rank ? 'RANK '+item.rank : '')}</span>
                        </div>
                    `).join('')}
                </div>
                <div class="info-panel">
                    <div class="detail-box" id="detail-pane">
                        ${this.getDetailContent(items[0])}
                    </div>
                    ${isRadio ? this.getVisualizerHTML() : ''}
                </div>
            </div>
        `;
    },

    getDetailContent(item) {
        if (!item) return "NO DATA SELECTED";
        if (this.currentSub === 'RADIO') return `FREQUENCY: 101.4 MHZ<br>NOW PLAYING:<br>${item.song || 'SIGNAL LOST...'}`;
        if (this.currentSub === 'WEAPONS') return `DAM: ${item.dam} | WT: ${item.wt} | VAL: ${item.val}<br><br>${item.desc}`;
        if (this.currentSub === 'QUESTS') return `STATUS: ${item.status}<br><br>${item.desc}`;
        if (this.currentSub === 'APPAREL') return `DR: ${item.dr} | WT: ${item.wt}<br><br>${item.desc}`;
        return item.desc || "SYSTEM STATUS: LOGGING ACTIVE. PREVIEW NOT AVAILABLE FOR THIS TYPE.";
    },

    getMapHTML(data) {
        return `
            <div style="height:280px; border:2px solid var(--pip-green); position:relative; background: radial-gradient(circle at center, #152515 0%, #050a05 100%);">
                <div style="position:absolute; top:35%; left:62%; width:12px; height:12px; background:white; border-radius:50%; box-shadow: 0 0 15px white; animation: blink 1s infinite;"></div>
                <div style="position:absolute; bottom:10px; left:10px; font-size:0.7rem;">ZONE: ${data.pos}<br>SECTOR: ${data.loc}</div>
                <div style="position:absolute; top:0; left:0; width:100%; height:100%; opacity:0.1; background-image: 
                    linear-gradient(var(--pip-green-dim) 1px, transparent 1px),
                    linear-gradient(90deg, var(--pip-green-dim) 1px, transparent 1px);
                    background-size: 20px 20px;"></div>
            </div>
        `;
    },

    getVisualizerHTML() {
        let bars = '';
        for(let i=0; i<20; i++) bars += `<div class="v-bar" style="animation-delay: ${Math.random()}s"></div>`;
        return `<div class="visualizer">${bars}</div>`;
    },

    initListEvents() {
        const items = document.querySelectorAll('.list-entry');
        const detailPane = document.getElementById('detail-pane');
        const data = ENGINE_DATA[this.currentTab].content[this.currentSub];
        items.forEach(item => {
            item.onclick = () => {
                items.forEach(i => i.classList.remove('selected'));
                item.classList.add('selected');
                const idx = item.getAttribute('data-idx');
                detailPane.innerHTML = this.getDetailContent(data[idx]);
            };
        });
    },

    triggerFlicker(dur) {
        const screen = document.getElementById('crt-screen');
        screen.classList.add('flicker-heavy');
        setTimeout(() => screen.classList.remove('flicker-heavy'), dur);
    },

    startGlitches() {
        setInterval(() => {
            if (this.isPowerOn && Math.random() > 0.96) this.triggerFlicker(80 + Math.random() * 120);
        }, 3000);
    }
};

window.onload = () => ui.init();
</script>

</body>
</html>
